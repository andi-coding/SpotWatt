name = "spotwatt-prices"
main = "src/index.js"
compatibility_date = "2024-01-17"

# wrangler.toml (wrangler v3.88.0^)
[observability.logs]
enabled = true

# Environment variables
[vars]
# Secrets (hinzufügen mit npx wrangler secret put <NAME>):
# - ENTSOE_API_TOKEN: ENTSO-E API Token für Preis-Daten
# - FIREBASE_SERVICE_ACCOUNT_KEY: Firebase Service Account für FCM Push
# - ADMIN_API_KEY: Admin Key für Test-Endpoints
#
# Optional (für CDN Cache Purge):
# - CLOUDFLARE_ZONE_ID: Zone ID für Cache Purge API
# - CLOUDFLARE_API_TOKEN: API Token mit "Cache Purge" Permission

# KV Namespace für Caching
# Erstellen mit: npx wrangler kv:namespace create "PRICE_CACHE"
# Dann die generierte ID hier eintragen
[[kv_namespaces]]
binding = "PRICE_CACHE"
id = "51ae355e5c7749e1915440c1337170d8"

# D1 Database für FCM Device Tokens
[[d1_databases]]
binding = "FCM_DB"
database_name = "spotwatt-fcm-tokens"
database_id = "b1e2ec5c-adf1-4bba-81a9-10d71996943c"

# Cron Triggers - ENTSO-E publiziert Day-Ahead Preise täglich um 12:30 CET/CEST
# Max 5 Trigger (Cloudflare Free Plan Limit)
# Erster Versuch um 12:00 UTC, dann alle 30 Min, letzter um 14:30 UTC
[triggers]
crons = [
  "0 12 * * *",   # 12:00 UTC = 13:00 CET / 14:00 CEST
  "30 12 * * *",  # 12:30 UTC = 13:30 CET / 14:30 CEST
  "0 13 * * *",   # 13:00 UTC = 14:00 CET / 15:00 CEST
  "30 13 * * *",  # 13:30 UTC = 14:30 CET / 15:30 CEST
  "30 14 * * *"   # 14:30 UTC = 15:30 CET / 16:30 CEST (letzter Versuch)
]